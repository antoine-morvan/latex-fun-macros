%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Welcome to Overleaf --- just edit your LaTeX on the left,
% and we'll compile it for you on the right. If you give
% someone the link to this page, they can edit at the same
% time. See the help menu above for more info. Enjoy!
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass{report}
 
\usepackage[left=20mm,right=20mm, top=30mm, bottom=30mm,a4paper]{geometry}
\usepackage[usenames,dvipsnames,table,xcdraw]{xcolor}
 
\usepackage{pgfplots}
\usepackage{setspace}
 
\usepackage{siunitx}
\usepackage{tikz}
\usepackage{wallpaper}
\usepackage{xintexpr}
\usetikzlibrary{shadows}
 
%% originaly used with babel french, which causes some issues
%% wihout the following line
\usetikzlibrary{babel}
 
\makeatletter
\newcommand*{\getlengthincm}[1]{\strip@pt\dimexpr0.035146\dimexpr#1\relax\relax}
\makeatother
 
 
\newcommand{\nume}[1]{\num[group-separator=\text{~},output-decimal-marker={,},group-digits=integer,group-minimum-digits=4]{#1}}
 
%%
%% #1 = label width
%% #2 = list of titles and values
%%
%% example:
%%
%%	\barchart{6cm}{
%%		apples/2047,
%%		pears/1244,
%%		banana/1208,
%%		{a fruit name with slashes / well / ...}/1055,
%%		{a fruit name}/9009
%%	}
%%
\newcommand{\barchart}[2]{
	%% reorder list (thanks \foreach...)
	\foreach  \l/\x[count=\y] in {#2} {
		\ifthenelse{\equal{\y}{1}}{
			\xdef\orderedList{{\l}/\x}
		}{
			\xdef\orderedList{{\l}/\x, \orderedList}
		}
	}
 
	%% compute bar length to adjust to textwidth
	\newdimen\barlength
	\setlength{\barlength}{\textwidth}
	\addtolength{\barlength}{-#1}
	\addtolength{\barlength}{-2cm}
 
	\def\maxval{0} %% stores the maximum value of input data
	\newcount\barcount \barcount=0
	\foreach  \l/\x[count=\y] in \orderedList {
		\global\edef\maxval{\xinttheiiexpr max(\x,\maxval)\relax}
		\global\advance\barcount by 1
	}
	\edef\maxval{\xintthefloatexpr (\maxval*110)/100\relax} %% add 10% to the max value for dimensionning the graph
 
	\def\xstep{\xinttheiexpr [10] \getlengthincm{\barlength}/\maxval \relax} %% compute the x steps
 
	{ %% add group to avoid spreading stretch value
		\setstretch{0.6}
		\begin{tikzpicture}[x={(\xstep,0)}]
			\foreach  \l/\x[count=\y] in \orderedList { 
				%% \l = label name
				%% \x = input data
				\node[left] at (0,\y) {
					%% surround the data within a tabular
					\begin{tabular}{>{
							%\columncolor{white}
							\raggedleft\arraybackslash}p{#1}} \small \l \end{tabular}
				};
				%% draw bar
				\filldraw[blue!50, draw=blue!50!black] (0,\y-.3) rectangle (\x,\y+.3);
				%% draw value as a node
				\node[right] at (\x, \y) {\small\nume{\x}};
			}
			%% draw axis bar
			\draw (0,0.5) -- (0,\xintthefloatexpr{\the\barcount + 0.5}\relax);
 
		\end{tikzpicture}
	}
}
 
 
\begin{document}
 
\barchart{3cm}{
     {a line with slashes / and multiline}/666
}
 
\begin{figure}
     \barchart{4cm}{
         TITI/25000,
         TATA/15000,
         TUTU/3900
     }
     \caption{test bar chart}
\end{figure}
 
\end{document}
